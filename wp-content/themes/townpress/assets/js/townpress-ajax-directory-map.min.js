!function(r){"use strict";if(r(document).ready(function(){r.fn.lsvrTownpressDirectoryMap&&r("#lsvr_listing-map__canvas").each(function(){r(this).lsvrTownpressDirectoryMap()})}),!r.fn.lsvrTownpressDirectoryMap){var a,t={init:function(){r.fn.lsvrTownpressLoadGoogleMapsApi&&r.fn.lsvrTownpressLoadGoogleMapsApi();var a=r(this),t=a.data("maptype")?a.data("maptype"):"terrain",s=a.data("zoom")?a.data("zoom"):17,o=!(!a.data("mousewheel")||!0!==String(a.data("mousewheel"))),n=a.attr("id"),i=a.data("query")?a.data("query"):{},e=function(){switch(t){case"roadmap":t=google.maps.MapTypeId.ROADMAP;break;case"satellite":t=google.maps.MapTypeId.SATELLITE;break;case"hybrid":t=google.maps.MapTypeId.HYBRID;break;default:t=google.maps.MapTypeId.TERRAIN}var e={zoom:s,mapTypeId:t,scrollwheel:o};"undefined"!=typeof lsvr_townpress_google_maps_style_json?e.styles=JSON.parse(lsvr_townpress_google_maps_style_json):"undefined"!=typeof lsvr_townpress_google_maps_style?e.styles=lsvr_townpress_google_maps_style:e.styles=[{featureType:"poi",stylers:[{visibility:"off"}]}];var r=new google.maps.Map(document.getElementById(n),e);a.data("map",r);a.data("mapMarkers",[]);a.data("mapMarkerClusterer",!1),a.lsvrTownpressDirectoryMap("ajaxRequest",i)};"object"==typeof google&&"object"==typeof google.maps?e():r(document).on("lsvrTownpressGoogleMapsApiLoaded",function(){e()})},update:function(e){void 0!==e&&this.lsvrTownpressDirectoryMap("ajaxRequest",e)},ajaxRequest:function(e){if(void 0!==e){var r=this;"undefined"!=typeof lsvr_townpress_ajax_directory_map_var&&(void 0!==a&&a.abort(),a=jQuery.ajax({type:"post",dataType:"JSON",url:lsvr_townpress_ajax_directory_map_var.url,data:{action:"lsvr-townpress-ajax-directory-map",nonce:encodeURIComponent(lsvr_townpress_ajax_directory_map_var.nonce),query:e},success:function(e){r.lsvrTownpressDirectoryMap("refresh",e)}}))}},refresh:function(e){if("object"==typeof google&&"object"==typeof google.maps&&this.data("map")&&this.data("mapMarkers")){var l=this,p=l.data("map"),m=l.data("mapMarkers"),g=l.data("mapMarkerClusterer"),d=!!e.hasOwnProperty("locations")&&e.locations,_=!!e.hasOwnProperty("labels")&&e.labels,c=!!e.hasOwnProperty("markerclusterpath")&&e.markerclusterpath;if(!1!==d){!function(){if(0<d.length){1===d.length&&d[0].hasOwnProperty("latitude")&&d[0].hasOwnProperty("longitude")&&p.setOptions({center:new google.maps.LatLng(d[0].latitude,d[0].longitude)});var e={content:"",disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-140,5),zIndex:null,boxStyle:{width:"280px"},closeBoxMargin:"10px 2px 2px 2px",closeBoxURL:"",infoBoxClearance:new google.maps.Size(1,1),visible:!0,pane:"floatPane",enableEventPropagation:!1},r=new InfoBox(e),a=!1;google.maps.event.addListener(r,"domready",function(){a=google.maps.event.addListener(p,"click",function(){r.close(),google.maps.event.removeListener(a)})});for(var t=new google.maps.LatLngBounds,s=0;s<m.length;s++)m[s].setMap(null);for(m=[],s=0;s<d.length;s++)if(d[s].hasOwnProperty("latitude")&&d[s].hasOwnProperty("longitude")){"function"==typeof RichMarker&&d[s].hasOwnProperty("thumburl")?m[s]=new RichMarker({position:new google.maps.LatLng(d[s].latitude,d[s].longitude),map:p,shadow:"none",content:'<div class="lsvr_listing-map__marker lsvr_listing-map__marker--has-thumb lsvr_listing-map__marker--id-'+d[s].id+'"><div class="lsvr_listing-map__marker-inner lsvr_listing-map__marker-inner--has-thumb" style="background-image: url(\''+d[s].thumburl+"');\"></div></div>"}):m[s]=new RichMarker({position:new google.maps.LatLng(d[s].latitude,d[s].longitude),map:p,shadow:"none",content:'<div class="lsvr_listing-map__marker lsvr_listing-map__marker--id-'+d[s].id+'"><div class="lsvr_listing-map__marker-inner"></div></div>'}),l.data("mapMarkers",m);var o="";if(d[s].hasOwnProperty("thumburl")?o+='<div class="lsvr_listing-map__infobox lsvr_listing-map__infobox--has-thumb">':o+='<div class="lsvr_listing-map__infobox">',o+='<div class="lsvr_listing-map__infobox-inner">',d[s].hasOwnProperty("thumburl")&&d[s].hasOwnProperty("permalink")&&(o+='<a href="'+d[s].permalink+'" class="lsvr_listing-map__infobox-thumb" style="background-image: url( \''+d[s].thumburl+"' ); \"></a>"),d[s].hasOwnProperty("title")&&d[s].hasOwnProperty("permalink")&&(o+='<h4 class="lsvr_listing-map__infobox-title">',o+='<a href="'+d[s].permalink+'" class="lsvr_listing-map__infobox-title-link">'+d[s].title,o+="</a></h4>"),d[s].hasOwnProperty("address")&&(o+='<p class="lsvr_listing-map__infobox-address">'+d[s].address.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</p>"),d[s].hasOwnProperty("category")&&void 0!==_.marker_infowindow_cat_prefix){for(var n="",i=0;i<d[s].category.length;i++)d[s].category[i].hasOwnProperty("name")&&d[s].category[i].hasOwnProperty("url")&&(n+='<a href="'+d[s].category[i].url+'" class="lsvr_listing-map__infobox-category-link">'+d[s].category[i].name+"</a>",i<d[s].category.length-1&&(n+=", "));o+='<p class="lsvr_listing-map__infobox-category">'+_.marker_infowindow_cat_prefix.replace("%s",n)+"</p>"}void 0!==_.marker_infowindow_more_link&&d[s].hasOwnProperty("permalink")&&(o+='<p class="lsvr_listing-map__infobox-more"><a href="'+d[s].permalink+'" class="lsvr_listing-map__infobox-more-link">'+_.marker_infowindow_more_link+"</a></p>"),o+="</div></div>",m[s].infoboxContent=o,google.maps.event.addListener(m[s],"click",function(){r.close(),!1!==a&&google.maps.event.removeListener(a),r.setContent(this.infoboxContent),r.open(p,this)}),1<d.length&&t.extend(m[s].position)}"function"==typeof MarkerClusterer&&(!1!==g&&g.clearMarkers(),g=new MarkerClusterer(p,m,{styles:[{width:58,height:58,url:c+"markercluster1.png",textColor:"white",textSize:12},{width:58,height:58,url:c+"markercluster2.png",textColor:"white",textSize:12},{width:58,height:58,url:c+"markercluster3.png",textColor:"white",textSize:12},{width:58,height:58,url:c+"markercluster4.png",textColor:"white",textSize:12},{width:58,height:58,url:c+"markercluster5.png",textColor:"white",textSize:12}]}),l.data("mapMarkerClusterer",g)),1<d.length&&p.fitBounds(t),l.removeClass("lsvr_listing-map__canvas--loading"),l.parent().find(".lsvr_listing-map__spinner").remove()}}()}else l.parent().hide()}}};r.fn.lsvrTownpressDirectoryMap=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):t.init.apply(this,arguments)}}}(jQuery);