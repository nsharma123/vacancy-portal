!function(e){"use strict";e(document).ready(function(){e.fn.lsvrTownpressToolkitWeatherWidget&&e(".lsvr-townpress-weather-widget__weather").each(function(){e(this).lsvrTownpressToolkitWeatherWidget()})}),e.fn.lsvrTownpressToolkitWeatherWidget||(e.fn.lsvrTownpressToolkitWeatherWidget=function(){var t=e(this),r=t.find(".lsvr-townpress-weather-widget__weather-spinner"),i=!!t.data("ajax-params")&&t.data("ajax-params"),n=t.data("forecast-length")&&!isNaN(t.data("forecast-length"))?parseInt(t.data("forecast-length")):0;!1!==i&&"undefined"!=typeof lsvr_townpress_toolkit_ajax_weather_widget_var&&jQuery.ajax({type:"post",dataType:"JSON",url:lsvr_townpress_toolkit_ajax_weather_widget_var.url,data:{action:"lsvr-townpress-toolkit-ajax-weather-widget",nonce:encodeURIComponent(lsvr_townpress_toolkit_ajax_weather_widget_var.nonce),data:i},success:function(r){if("object"==typeof r)if("error"in r)t.attr("data-response-error",r.error),t.slideUp(200);else{var i={},s=[];if("current"in r&&("name"in r.current&&t.attr("data-response-current-location",r.current.name),"main"in r.current&&"temp"in r.current.main&&(i.temperature=String(Math.round(r.current.main.temp))),"wind"in r.current&&"speed"in r.current.wind&&(i.wind=Math.floor(r.current.wind.speed)),"weather"in r.current&&e.isArray(r.current.weather)&&"icon"in r.current.weather[0]&&(i.icon=r.current.weather[0].icon)),"forecast"in r&&"list"in r.forecast){"city"in r.forecast&&"name"in r.forecast.city&&t.attr("data-response-forecast-location",r.forecast.city.name);for(var o=0;o<n;o++){var d=t.find(".lsvr-townpress-weather-widget__weather-item--forecast-"+parseInt(o+1)).data("timestamp"),w=0;jQuery.each(r.forecast.list,function(){if("dt"in this&&parseInt(this.dt)===d)return w=r.forecast.list.indexOf(this),!1}),s[o]={};var c=-1e3,l=-1e3,h=-1e3;"main"in r.forecast.list[w]&&"temp"in r.forecast.list[w].main&&(c=parseInt(String(Math.round(r.forecast.list[w].main.temp)))),"main"in r.forecast.list[w+1]&&"temp"in r.forecast.list[w+1].main&&(l=parseInt(String(Math.round(r.forecast.list[w+1].main.temp)))),"main"in r.forecast.list[w+2]&&"temp"in r.forecast.list[w+2].main&&(h=parseInt(String(Math.round(r.forecast.list[w+2].main.temp))));var f=Math.max(c,l,h);f>-1e3&&(s[o].temperature=f),"wind"in r.forecast.list[w]&&"speed"in r.forecast.list[w].wind&&(s[o].wind=Math.floor(r.forecast.list[w].wind.speed)),"weather"in r.forecast.list[w]&&e.isArray(r.forecast.list[w].weather)&&"icon"in r.forecast.list[w].weather[0]&&(s[o].icon=r.forecast.list[w].weather[0].icon)}}a(i,s)}else t.slideUp(200)},error:function(){t.slideUp(200)}});var a=function(e,i){var n=t.find(".lsvr-townpress-weather-widget__weather-list"),a=n.find(".lsvr-townpress-weather-widget__weather-item--current"),s=n.find(".lsvr-townpress-weather-widget__weather-item--forecast"),o={i01d:"icon-sun",i01n:"icon-sun",i02d:"icon-cloud-sun",i02n:"icon-cloud",i03d:"icon-cloud",i03n:"icon-cloud",i04d:"icon-cloud",i04n:"icon-cloud",i09d:"icon-cloud-rain",i09n:"icon-cloud-rain",i10d:"icon-cloud-rain",i10n:"icon-cloud-rain",i11d:"icon-cloud-lightning",i11n:"icon-cloud-lightning",i13d:"icon-cloud-snow",i13n:"icon-cloud-snow",i50d:"icon-cloud-fog",i50n:"icon-cloud-fog"};if("temperature"in e&&"wind"in e&&"icon"in e){"i"+e.icon in o?a.find(".lsvr-townpress-weather-widget__weather-item-icon").addClass(o["i"+e.icon]):a.find(".lsvr-townpress-weather-widget__weather-item-icon").hide();var d=a.find(".lsvr-townpress-weather-widget__weather-item-temperature").text().trim();a.find(".lsvr-townpress-weather-widget__weather-item-temperature").html(e.temperature+d);var w=a.find(".lsvr-townpress-weather-widget__weather-item-wind").text().trim();a.find(".lsvr-townpress-weather-widget__weather-item-wind").html(e.wind+w)}if(i.length>0)for(var c=0;c<i.length;c++)if("temperature"in i[c]&&"wind"in i[c]&&"icon"in i[c]){var l=s.filter(".lsvr-townpress-weather-widget__weather-item--forecast-"+parseInt(c+1));"i"+i[c].icon in o?l.find(".lsvr-townpress-weather-widget__weather-item-icon").addClass(o["i"+i[c].icon]):l.find(".lsvr-townpress-weather-widget__weather-item-icon").hide();d=l.find(".lsvr-townpress-weather-widget__weather-item-temperature").text().trim();l.find(".lsvr-townpress-weather-widget__weather-item-temperature").html(i[c].temperature+d);w=l.find(".lsvr-townpress-weather-widget__weather-item-wind").text().trim();l.find(".lsvr-townpress-weather-widget__weather-item-wind").html(i[c].wind+w)}else s.filter(".lsvr-townpress-weather-widget__weather-item--forecast-"+parseInt(c+1)).hide();r.slideUp(200),n.slideDown(200),t.removeClass("lsvr-townpress-weather-widget__weather--loading")}})}(jQuery);